<!DOCTYPE html>
<html>
<head>
    <title>Midpoint Finder - Road & Retail</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA58LI1avl5xzd8mj9LLidnBVhRHGoaAsA&libraries=places"></script>
    <style>
        #map { height: 500px; width: 100%; border-radius: 8px; }
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .controls { margin-bottom: 15px; background: white; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>

    <h2>üìç Penentu Titik Tengah (Jalan & Minimarket)</h2>
    
    <div class="controls">
        <p>Klik dua kali pada peta untuk menentukan <b>Titik A</b> dan <b>Titik B</b></p>
        <button onclick="calculateMidpoint()">Cari Titik Tengah Strategis</button>
        <div id="info" style="margin-top:10px; color: #555;"></div>
    </div>

    <div id="map"></div>

    <script>
        let map, markers = [], polyline;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -6.2000, lng: 106.8166 }, // Jakarta
                zoom: 12,
            });

            map.addListener("click", (e) => {
                if (markers.length >= 2) {
                    markers.forEach(m => m.setMap(null));
                    markers = [];
                }
                addMarker(e.latLng);
            });
        }

        function addMarker(latLng) {
            const marker = new google.maps.Marker({ position: latLng, map: map });
            markers.push(marker);
        }

        function calculateMidpoint() {
            if (markers.length < 2) return alert("Pilih dua titik dulu!");

            const p1 = markers[0].getPosition();
            const p2 = markers[1].getPosition();
            
            // 1. Hitung Midpoint Matematis
            const midLat = (p1.lat() + p2.lat()) / 2;
            const midLng = (p1.lng() + p2.lng()) / 2;
            const midPoint = new google.maps.LatLng(midLat, midLng);

            // 2. Cari Alfamart/Indomaret terdekat dari midpoint
            const service = new google.maps.places.PlacesService(map);
            const request = {
                location: midPoint,
                radius: '1000', // Jari-jari 1km
                query: 'Indomaret Alfamart'
            };

            service.textSearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    const nearestStore = results[0]; // Ambil yang paling dekat
                    
                    new google.maps.Marker({
                        position: nearestStore.geometry.location,
                        map: map,
                        icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                        title: "Titik Temu: " + nearestStore.name
                    });

                    map.setCenter(nearestStore.geometry.location);
                    map.setZoom(15);
                    
                    document.getElementById("info").innerHTML = 
                        `<b>Rekomendasi Titik Temu:</b> ${nearestStore.name}<br>` +
                        `<b>Alamat:</b> ${nearestStore.formatted_address}`;
                } else {
                    alert("Tidak ditemukan minimarket di sekitar titik tengah.");
                }
            });
        }

        window.onload = initMap;
    </script>
</body>
</html>